<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <title>Інтерактив — Циклічні алгоритми</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: Arial, sans-serif; background:#f7f9fb; color:#222; padding:24px; }
    h1 { margin-bottom:16px; }
    #interactive-toggle { background:#2563eb; color:#fff; border:none; padding:10px 14px; border-radius:8px; cursor:pointer; }
    #interactive-container { margin-top:16px; display:none; }
    .note { color:#555; font-size:13px; margin-top:12px; }
  </style>
</head>
<body>
  <h1>Навчальні матеріали — Інтерактив (Цикли)</h1>

  <p>
    <button id="interactive-toggle">Інтерактиви</button>
  </p>

  <!-- тут з'явиться інтерактив -->
  <div id="interactive-container"></div>

  <!-- React (production build) -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- standalone interactive (no JSX) -->
  <script>
  (function(window){
    // interactive.js embedded — standalone React component (no JSX).
    const React = window.React;
    const ReactDOM = window.ReactDOM;
    if (!React || !ReactDOM) {
      console.warn('React or ReactDOM not found. Please include React and ReactDOM before this script');
    }

    function InteractiveLoops(){
      const useState = React.useState;
      const useEffect = React.useEffect;
      const useRef = React.useRef;

      const [tab, setTab] = useState('theory');
      const [loopType, setLoopType] = useState('for');
      const [start, setStart] = useState(1);
      const [end, setEnd] = useState(5);
      const [step, setStep] = useState(1);
      const [variableName, setVariableName] = useState('i');
      const [example, setExample] = useState('sum');

      const [steps, setSteps] = useState([]);
      const [currentStepIndex, setCurrentStepIndex] = useState(0);
      const [running, setRunning] = useState(false);
      const intervalRef = useRef(null);

      useEffect(()=>{
        if (running){
          intervalRef.current = setInterval(()=>{
            setCurrentStepIndex(s=>{
              if (s < steps.length - 1) return s+1;
              clearInterval(intervalRef.current);
              setRunning(false);
              return s;
            });
          }, 700);
        }
        return ()=> clearInterval(intervalRef.current);
      }, [running, steps]);

      function generateSteps(){
        const s = Number(start);
        const e = Number(end);
        const st = Number(step) || 1;
        const arr = [];
        if (loopType === 'for'){
          if (st === 0){ alert('Крок не може бути 0'); return; }
          const ascending = st > 0;
          if ((ascending && s > e) || (!ascending && s < e)){
            arr.push({label: `Ініціалізація: ${variableName} = ${s}`, vars: {[variableName]: s}});
            arr.push({label: 'Умова відразу хибна — тіло циклу не виконується', vars:{}});
            setSteps(arr); setCurrentStepIndex(0); return;
          }
          let acc = example === 'sum' ? 0 : example === 'fact' ? 1 : null;
          let index = 0;
          arr.push({label: `Ініціалізація: ${variableName} = ${s}`, vars: {[variableName]: s, acc}});
          for (let i = s; ascending ? i <= e : i >= e; i += st){
            index++;
            if (example === 'sum'){ acc += i; arr.push({label:`Крок ${index}: ${variableName} = ${i} → acc = acc + ${i} = ${acc}`, vars:{[variableName]: i, acc}}); }
            else if (example === 'fact'){ acc *= i; arr.push({label:`Крок ${index}: ${variableName} = ${i} → acc = acc * ${i} = ${acc}`, vars:{[variableName]: i, acc}}); }
            else if (example === 'print'){ arr.push({label:`Крок ${index}: ${variableName} = ${i} → вивід: ${i}`, vars:{[variableName]: i}}); }
            else if (example === 'max'){ if (index===1) acc = i; else acc = Math.max(acc, i); arr.push({label:`Крок ${index}: ${variableName} = ${i} → acc = max(acc, ${i}) = ${acc}`, vars:{[variableName]: i, acc}}); }
          }
          arr.push({label:`Кінець циклу — результат: ${acc !== null ? acc : '—'}`, vars:{acc}});
        } else if (loopType === 'while'){
          if (st === 0){ alert('Крок не може бути 0'); return; }
          let i = s; let acc = example === 'sum' ? 0 : example === 'fact' ? 1 : null; let idx = 0;
          arr.push({label:`Ініціалізація: ${variableName} = ${i}`, vars:{[variableName]: i, acc}});
          const cond = x => (st > 0 ? x <= e : x >= e);
          while (cond(i)){
            idx++;
            if (example === 'sum'){ acc += i; arr.push({label:`Крок ${idx}: ${variableName} = ${i} → acc = ${acc}`, vars:{[variableName]: i, acc}}); }
            else if (example === 'fact'){ acc *= i; arr.push({label:`Крок ${idx}: ${variableName} = ${i} → acc = ${acc}`, vars:{[variableName]: i, acc}}); }
            else if (example === 'print'){ arr.push({label:`Крок ${idx}: ${variableName} = ${i} → вивід: ${i}`, vars:{[variableName]: i}}); }
            i += st; arr.push({label:`Оновлення: ${variableName} += ${st} → ${variableName} = ${i}`, vars:{[variableName]: i, acc}});
            if (idx > 1000){ arr.push({label:'Занадто багато ітерацій — зупинка', vars:{}}); break; }
          }
          arr.push({label:`Умова хибна — кінець. Результат: ${acc !== null ? acc : '—'}`, vars:{acc}});
        } else if (loopType === 'do'){
          let i = s; let acc = example === 'sum' ? 0 : example === 'fact' ? 1 : null; let idx = 0;
          do {
            idx++;
            if (example === 'sum'){ acc += i; arr.push({label:`Крок ${idx}: ${variableName} = ${i} → acc = ${acc}`, vars:{[variableName]: i, acc}}); }
            else if (example === 'fact'){ acc *= i; arr.push({label:`Крок ${idx}: ${variableName} = ${i} → acc = ${acc}`, vars:{[variableName]: i, acc}}); }
            else if (example === 'print'){ arr.push({label:`Крок ${idx}: ${variableName} = ${i} → вивід: ${i}`, vars:{[variableName]: i}}); }
            i += st; arr.push({label:`Оновлення: ${variableName} += ${st} → ${variableName} = ${i}`, vars:{[variableName]: i, acc}});
            if (idx > 1000){ arr.push({label:'Занадто багато ітерацій — зупинка', vars:{}}); break; }
          } while (st > 0 ? i <= e : i >= e);
          arr.push({label:`Кінець do..while. Результат: ${acc !== null ? acc : '—'}`, vars:{acc}});
        }
        setSteps(arr); setCurrentStepIndex(0);
      }

      function stepBackward(){ setCurrentStepIndex(s => Math.max(0, s-1)); setRunning(false); }
      function stepForward(){ setCurrentStepIndex(s => Math.min(steps.length-1, s+1)); setRunning(false); }

      const tasks = [
        {id:1, title:'Сума чисел від 1 до N', description:'Введіть формулу (використайте N) для суми чисел від 1 до N', answer:'N*(N+1)/2'},
        {id:2, title:'Кількість ітерацій', description:'Скільки разів виконається цикл for(i=3; i<=15; i+=2)?', answer:'7'},
        {id:3, title:'Факторіал N', description:'Який запис для факторіалу N (наприклад для N=5 результат 120)?', answer:'N!'},
        {id:4, title:'Сума парних від 1 до 10', description:'Знайдіть суму парних чисел від 1 до 10', answer:'30'},
        {id:5, title:"Цикл з від'ємним кроком", description:'Скільки ітерацій виконається for(i=10; i>0; i-=3)?', answer:'4'}
      ];

      const [taskAnswers, setTaskAnswers] = useState({});
      const [taskResults, setTaskResults] = useState({});

      function checkTaskById(id){ const task = tasks.find(t=>t.id===id); if(!task) return; const user = (taskAnswers[id]|| '').replace(/\s+/g,'').toLowerCase(); const correct = (task.answer||'').replace(/\s+/g,'').toLowerCase(); const ok = user===correct; setTaskResults(r=>({ ...r, [id]: ok })); }

      const h = React.createElement;
      function tabButton(name, label){ return h('button', { onClick: ()=>setTab(name), style:{ padding:'6px 10px', marginRight:8, background: tab===name ? '#2563eb':'#edf2f7', border:'none', borderRadius:6, cursor:'pointer' } }, label ); }

      return h('div', { style:{fontFamily:'Arial, sans-serif'} },
        h('div', { style:{display:'flex', gap:12, marginBottom:12} }, tabButton('theory','Теорія'), tabButton('sim','Симулятор'), tabButton('tasks','Завдання')),
        tab === 'theory' ? h('div', { style:{background:'#fff', padding:12, borderRadius:8} }, h('h3', null, 'Коротко про цикли'), h('ul', null, h('li', null, h('b', null, 'for'), ' — коли відома кількість ітерацій.'), h('li', null, h('b', null, 'while'), ' — поки умова істинна.'), h('li', null, h('b', null, 'do...while'), ' — виконується принаймні один раз.')) : null,
        tab === 'sim' ? h('div', { style:{background:'#fff', padding:12, borderRadius:8} },
          h('div', { style:{display:'grid', gridTemplateColumns:'1fr 2fr', gap:12} },
            h('div', null,
              h('label', null, 'Тип циклу'),
              h('select', { value: loopType, onChange: e=>setLoopType(e.target.value), style:{width:'100%'} }, h('option', { value:'for' }, 'for'), h('option', { value:'while' }, 'while'), h('option', { value:'do' }, 'do...while')),
              h('label', { style:{display:'block', marginTop:8} }, 'Початок'),
              h('input', { type:'number', value:start, onChange: e=>setStart(Number(e.target.value)), style:{width:'100%'} }),
              h('label', { style:{display:'block', marginTop:8} }, 'Кінець'),
              h('input', { type:'number', value:end, onChange: e=>setEnd(Number(e.target.value)), style:{width:'100%'} }),
              h('label', { style:{display:'block', marginTop:8} }, 'Крок'),
              h('input', { type:'number', value:step, onChange: e=>setStep(Number(e.target.value)), style:{width:'100%'} }),
              h('label', { style:{display:'block', marginTop:8} }, 'Приклад'),
              h('select', { value:example, onChange: e=>setExample(e.target.value), style:{width:'100%'} }, h('option', { value:'sum' }, 'Сума 1..N'), h('option', { value:'fact' }, 'Факторіал'), h('option', { value:'print' }, 'Вивести числа'), h('option', { value:'max' }, 'Максимум')),
              h('div', { style:{marginTop:8} }, h('button', { onClick: generateSteps, style:{marginRight:8} }, 'Згенерувати кроки'), h('button', { onClick: ()=>setRunning(true), style:{marginRight:8} }, 'Запустити'), h('button', { onClick: ()=>setRunning(false) }, 'Пауза'))
            ),
            h('div', null, h('div', { style:{height:220, overflow:'auto', background:'#f3f4f6', padding:8, borderRadius:6} }, steps.map((stp, idx) => (h('div', { key: idx, style:{padding:6, marginBottom:6, background: idx===currentStepIndex ? '#e6f2ff' : '#fff', borderRadius:4} }, h('div', { style:{fontSize:13} }, stp.label), (stp.vars && Object.keys(stp.vars).length>0) ? h('div', { style:{fontSize:11, color:'#666', marginTop:4} }, Object.entries(stp.vars).map(([k,v])=> `${k}=${v}`).join(' | ')) : null ))))
          )
        ) : null,
        tab === 'tasks' ? h('div', { style:{background:'#fff', padding:12, borderRadius:8} }, tasks.map(t => (h('div', { key: t.id, style:{borderBottom:'1px solid #eee', padding:8} }, h('div', { style:{fontWeight:600} }, t.title), h('div', { style:{fontSize:13, color:'#666'} }, t.description), h('input', { placeholder:'Ваша відповідь', value: taskAnswers[t.id]||'', onChange: e=>{ setTaskAnswers(a=>({ ...a, [t.id]: e.target.value })); checkTaskById(t.id); }, style:{width:'100%', marginTop:6, padding:6} }), h('div', { style:{marginTop:6} }, h('button', { onClick: ()=>checkTaskById(t.id) }, 'Перевірити'), taskResults[t.id] !== undefined ? h('span', { style:{marginLeft:8, color: taskResults[t.id] ? 'green' : 'red'} }, taskResults[t.id] ? 'Правильно ✅' : 'Неправильно ❌') : null )))) ) : null
      );
    }

    function mountInteractive(containerId){
      const el = document.getElementById(containerId);
      if (!el) { console.error('Container with id \"'+containerId+'\" not found'); return; }
      const root = ReactDOM.createRoot(el);
      root.render(React.createElement(InteractiveLoops));
      return function unmount(){ root.unmount(); };
    }

    window.mountInteractive = mountInteractive;
  })(window);
  </script>

  <!-- toggle / mount script -->
  <script>
    (function(){
      const btn = document.getElementById('interactive-toggle');
      const container = document.getElementById('interactive-container');
      let mounted = false;
      btn.addEventListener('click', function(){
        if (!mounted) {
          container.style.display = 'block';
          if (window.mountInteractive) {
            window.mountInteractive('interactive-container');
            mounted = true;
            btn.textContent = 'Приховати інтерактиви';
          } else {
            console.error('mountInteractive not found.');
            alert('Помилка: інтерактив не знайдено.');
          }
        } else {
          if (container.style.display === 'none' || container.style.display === '') {
            container.style.display = 'block';
            btn.textContent = 'Приховати інтерактиви';
          } else {
            container.style.display = 'none';
            btn.textContent = 'Інтерактиви';
          }
        }
      });
    })();
  </script>

  <div class="note">Порада: цей HTML використовує React через CDN. Для продакшену краще збирати компонент у бандл і підключати вже зкомпільований скрипт.</div>
</body>
</html>
